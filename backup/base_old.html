<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Auto-Summarizer{% endblock %}</title>
    
    <!-- Prevent FOUC by setting theme immediately -->
    <script>
        // On page load or when changing themes, best to add inline in head to avoid FOUC
        document.documentElement.classList.toggle(
            "dark",
            localStorage.theme === "dark" ||
            (!("theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches)
        );
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        @import url('https://rsms.me/inter/inter.css');
        
        /* Dark mode toggle */
        .dark-mode-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: rgb(255 255 255 / 1);
            border: 1px solid rgb(226 232 240 / 1);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .dark .dark-mode-toggle {
            background-color: rgb(30 41 59 / 1);
            border-color: rgb(51 65 85 / 1);
            color: rgb(241 245 249 / 1);
        }
        
        .dark-mode-toggle:hover {
            background-color: rgb(248 250 252 / 1);
        }
        
        .dark .dark-mode-toggle:hover {
            background-color: rgb(51 65 85 / 1);
        }
        
        /* Navigation Tab Styles */
        .nav-tab {
            flex: 1;
            text-align: center;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            text-decoration: none;
        }
        
        .nav-tab-active {
            background-color: rgb(239 246 255);
            color: rgb(29 78 216);
        }
        
        .dark .nav-tab-active {
            background-color: rgb(30 58 138 / 0.3);
            color: rgb(147 197 253);
        }
        
        .nav-tab-inactive {
            color: rgb(71 85 105);
        }
        
        .dark .nav-tab-inactive {
            color: rgb(148 163 184);
        }
        
        .nav-tab-inactive:hover {
            color: rgb(15 23 42);
            background-color: rgb(248 250 252);
        }
        
        .dark .nav-tab-inactive:hover {
            color: rgb(241 245 249);
            background-color: rgb(51 65 85);
        }
        
        .status-badge { 
            display: inline-flex; 
            align-items: center; 
            padding: 0.125rem 0.625rem; 
            border-radius: 9999px; 
            font-size: 0.75rem; 
            font-weight: 500; 
        }
        .status-completed { background-color: #dcfce7; color: #166534; }
        .status-failed { background-color: #fee2e2; color: #991b1b; }
        .status-processing { background-color: #fef3c7; color: #92400e; }
        
        .dark .status-completed { background-color: #1f3a23; color: #86efac; }
        .dark .status-failed { background-color: #3a1f1f; color: #fca5a5; }
        .dark .status-processing { background-color: #3a2f1f; color: #fbbf24; }
        
        /* Copy button styles */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            border-radius: 6px;
            padding: 6px;
            cursor: pointer;
            opacity: 0.7;
            transition: all 0.2s ease;
        }
        
        .copy-btn:hover {
            opacity: 1;
        }
        
        .copy-btn.copied {
            background-color: #10b981;
            color: white;
        }
        
        {% block extra_styles %}{% endblock %}
    </style>
    
    {% block head %}{% endblock %}
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-100 min-h-screen transition-colors">
    {% include 'components/dark_mode_toggle.html' %}
    
    <div class="w-full max-w-6xl mx-auto p-4 sm:p-8">
        {% include 'components/navigation.html' %}
        
        {% block content %}{% endblock %}
    </div>
    
    {% block modals %}{% endblock %}
    
    <!-- Base JavaScript for dark mode -->
    <script>
        // Dark mode functionality
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const sunIcon = document.getElementById('sun-icon');
        const moonIcon = document.getElementById('moon-icon');
        
        // Check if dark mode is enabled
        function isDarkMode() {
            return document.documentElement.classList.contains('dark');
        }
        
        // Update icons based on current theme
        function updateIcons() {
            if (isDarkMode()) {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            } else {
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            }
        }
        
        // Initialize icons on page load
        updateIcons();
        
        darkModeToggle.addEventListener('click', () => {
            if (isDarkMode()) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
            updateIcons();
        });

        // Copy to clipboard functionality
        function copyToClipboard(elementId, button) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                // Show success feedback
                const originalContent = button.innerHTML;
                button.innerHTML = '<svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>';
                button.classList.add('copied');
                
                setTimeout(() => {
                    button.innerHTML = originalContent;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            });
        }

        // Global utility functions for job management
        function getStatusClass(status) {
            const statusMap = {
                'COMPLETED': 'status-completed',
                'FAILED': 'status-failed',
                'PROCESSING': 'status-processing',
                'PENDING': 'status-processing'
            };
            return statusMap[status] || 'status-processing';
        }

        function openJobModal(jobId) {
            const job = allJobs ? allJobs.find(j => j.id === jobId) : null;
            if (job && typeof populateJobModal === 'function') {
                populateJobModal(job);
                openModal('job-modal');
            }
        }
    </script>
    
    {% block scripts %}{% endblock %}
</body>
</html>
